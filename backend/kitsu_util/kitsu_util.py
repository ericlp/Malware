
import requests


def get_user_id_by_name(name):
    c = requests.get("https://kitsu.io/api/edge/users?filter[name]="+name)
    try:
        # establish connection

        if c.status_code == 200:
            return c.json()['data'][0]['id']
    finally:
        c.close()

def get_user_library_entries(id):
    c = requests.get("https://kitsu.io/api/edge/users/" + id +"/library-entries")
    try:
        list = []
        if c.status_code == 200:
            for data in c.json()['data']:
                relation_link = data['relationships']['anime']['links']['related']
                c2 = requests.get(relation_link)


                list.append(c2.json()['data']['id'])
        return list
    finally:
        c.close()


def get_anime_by_entry(data):
    anime_url = data['relationships']['anime']['links']['related']
    anime = requests.get(anime_url)
    try:
        if anime.status_code == 200:
            return anime
    finally:
        anime.close()

def get_title_by_anime(anime):
    try:
        return anime['data']['attributes']['titles']['en']
    except KeyError:
        return anime['data']['attributes']['titles']['en_us']

def get_status_by_entry(data):
    return data['attributes']['status']

def get_progress_by_entry(data):
    return data['attributes']['progress']